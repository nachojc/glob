<sn-tab-group [selectIndex]="selectedTabIndex" (selectedTab)='tabsChanged($event)'>
    <sn-tab label="{{ 'branchlocator.title.map' | translate }}">
        <section class="locator-content">
            <agm-map [gestureHandling]="'greedy'" [showDefaultInfoWindow]="false" [disableDefaultUI]="true"
            [controlSize]="false" [panControl]="false" [streetViewControl]="false" [zoomControl]="false" [zoom]="zoom"
            (mapReady)="mapReady()" (mapClick)="mapClick($event)" (centerChange)="centerChange($event)">
                <agm-marker [agmFitBounds]="true" [latitude]="userPosition?.lat" [longitude]="userPosition?.lng"
                    [iconUrl]="usericon" [markerClickable]="false" [openInfoWindow]="false"></agm-marker>
                <agm-marker-cluster [styles]="clusterStyles" [maxZoom]="'15'" [minimumClusterSize]="5" [averageCenter]="true">
                    <agm-marker canChangeIcon *ngFor="let branch of branchesList" [title]="branch.id" [agmFitBounds]="true" [latitude]="branch.location.geoCoords.latitude"
                        [longitude]="branch.location.geoCoords.longitude" [iconUrl]="branchIcon" (markerClick)="markerSelected($event, branch)"
                        [markerClickable]="true" [openInfoWindow]="false"></agm-marker>
                </agm-marker-cluster>
            </agm-map>
            <section class="locator-center">
                <button class="center-map-user" (click)="centerMapToUser(false, true)">
                    <sn-icon icon="sn-SYS029"></sn-icon>
                </button>
            </section>
            <sn-drawer  #drawer [dockedHeight]="220" [state]="(showDrawer)? 1 : 0" [distanceTop]="64" (stateChange)="drawerStageChange($event)">
                <sn-branch-info *ngIf="selectedBranch" [branch]="selectedBranch" (branchInfoClicked)="drawer.changeState()" [isNearestMarker]="showNearest"></sn-branch-info>
            </sn-drawer>
            
            <sn-loading *ngIf="isLoading" full="true"></sn-loading>
        </section>
    </sn-tab>
    <sn-tab label="{{ 'branchlocator.title.list' | translate }}">
            <section class="result-list-wrapper">
                <sn-branch-list [isLoading]="isLoading" [branchesList]="branchesList" (branchSelected)="selectBranch($event)"></sn-branch-list>
            </section>
    </sn-tab>
</sn-tab-group>
<section class="locator-search">
    <div class="locator-search-container">
        <sn-branch-search-input [showReCenter]="showReCenter" [useGoogle]="true" [filterCount]="filterCounts"
        (placeChange)="placeChange($event)"
        (reCenter)="centerMapToUser(true, true)" (callFilter)="showFilter()"></sn-branch-search-input>
    </div>
</section>
<sn-filter modal (filterApply)="onFilterApply($event)" ></sn-filter>
